{"ast":null,"code":"import { testPromiseSupport } from '../helpers/test-promise-support';\nexport var createRenderNativeOfflineAudioContext = function createRenderNativeOfflineAudioContext(cacheTestResult, createNativeGainNode, createNativeScriptProcessorNode, testOfflineAudioContextCurrentTimeSupport) {\n  return function (nativeOfflineAudioContext) {\n    // Bug #21: Safari does not support promises yet.\n    if (cacheTestResult(testPromiseSupport, function () {\n      return testPromiseSupport(nativeOfflineAudioContext);\n    })) {\n      // Bug #158: Chrome and Edge do not advance currentTime if it is not accessed while rendering the audio.\n      return Promise.resolve(cacheTestResult(testOfflineAudioContextCurrentTimeSupport, testOfflineAudioContextCurrentTimeSupport)).then(function (isOfflineAudioContextCurrentTimeSupported) {\n        if (!isOfflineAudioContextCurrentTimeSupported) {\n          var scriptProcessorNode = createNativeScriptProcessorNode(nativeOfflineAudioContext, 512, 0, 1);\n\n          nativeOfflineAudioContext.oncomplete = function () {\n            scriptProcessorNode.onaudioprocess = null; // tslint:disable-line:deprecation\n\n            scriptProcessorNode.disconnect();\n          };\n\n          scriptProcessorNode.onaudioprocess = function () {\n            return nativeOfflineAudioContext.currentTime;\n          }; // tslint:disable-line:deprecation\n\n\n          scriptProcessorNode.connect(nativeOfflineAudioContext.destination);\n        }\n\n        return nativeOfflineAudioContext.startRendering();\n      });\n    }\n\n    return new Promise(function (resolve) {\n      // Bug #48: Safari does not render an OfflineAudioContext without any connected node.\n      var gainNode = createNativeGainNode(nativeOfflineAudioContext, {\n        channelCount: 1,\n        channelCountMode: 'explicit',\n        channelInterpretation: 'discrete',\n        gain: 0\n      });\n\n      nativeOfflineAudioContext.oncomplete = function (event) {\n        gainNode.disconnect();\n        resolve(event.renderedBuffer);\n      };\n\n      gainNode.connect(nativeOfflineAudioContext.destination);\n      nativeOfflineAudioContext.startRendering();\n    });\n  };\n};","map":{"version":3,"mappings":"AAAA,SAASA,kBAAT,QAAmC,iCAAnC;AAIA,OAAO,IAAMC,qCAAqC,GAA4C,SAAjFA,qCAAiF,CAC1FC,eAD0F,EAE1FC,oBAF0F,EAG1FC,+BAH0F,EAI1FC,yCAJ0F,EAK1F;EACA,OAAO,UAACC,yBAAD,EAA8B;IACjC;IACA,IAAIJ,eAAe,CAACF,kBAAD,EAAqB;MAAA,OAAMA,kBAAkB,CAACM,yBAAD,CAAxB;IAAA,CAArB,CAAnB,EAA8F;MAC1F;MACA,OAAOC,OAAO,CAACC,OAAR,CACHN,eAAe,CAACG,yCAAD,EAA4CA,yCAA5C,CADZ,EAELI,IAFK,CAEA,UAACC,yCAAD,EAA8C;QACjD,IAAI,CAACA,yCAAL,EAAgD;UAC5C,IAAMC,mBAAmB,GAAGP,+BAA+B,CAACE,yBAAD,EAA4B,GAA5B,EAAiC,CAAjC,EAAoC,CAApC,CAA3D;;UAEAA,yBAAyB,CAACM,UAA1B,GAAuC,YAAK;YACxCD,mBAAmB,CAACE,cAApB,GAAqC,IAArC,CADwC,CACG;;YAC3CF,mBAAmB,CAACG,UAApB;UACH,CAHD;;UAIAH,mBAAmB,CAACE,cAApB,GAAqC;YAAA,OAAMP,yBAAyB,CAACS,WAAhC;UAAA,CAArC,CAP4C,CAOsC;;;UAElFJ,mBAAmB,CAACK,OAApB,CAA4BV,yBAAyB,CAACW,WAAtD;QACH;;QAED,OAAOX,yBAAyB,CAACY,cAA1B,EAAP;MACH,CAhBM,CAAP;IAiBH;;IAED,OAAO,IAAIX,OAAJ,CAAgC,UAACC,OAAD,EAAY;MAC/C;MACA,IAAMW,QAAQ,GAAGhB,oBAAoB,CAACG,yBAAD,EAA4B;QAC7Dc,YAAY,EAAE,CAD+C;QAE7DC,gBAAgB,EAAE,UAF2C;QAG7DC,qBAAqB,EAAE,UAHsC;QAI7DC,IAAI,EAAE;MAJuD,CAA5B,CAArC;;MAOAjB,yBAAyB,CAACM,UAA1B,GAAuC,UAACY,KAAD,EAAwC;QAC3EL,QAAQ,CAACL,UAAT;QAEAN,OAAO,CAACgB,KAAK,CAACC,cAAP,CAAP;MACH,CAJD;;MAMAN,QAAQ,CAACH,OAAT,CAAiBV,yBAAyB,CAACW,WAA3C;MAEAX,yBAAyB,CAACY,cAA1B;IACH,CAlBM,CAAP;EAmBH,CA1CD;AA2CH,CAjDM","names":["testPromiseSupport","createRenderNativeOfflineAudioContext","cacheTestResult","createNativeGainNode","createNativeScriptProcessorNode","testOfflineAudioContextCurrentTimeSupport","nativeOfflineAudioContext","Promise","resolve","then","isOfflineAudioContextCurrentTimeSupported","scriptProcessorNode","oncomplete","onaudioprocess","disconnect","currentTime","connect","destination","startRendering","gainNode","channelCount","channelCountMode","channelInterpretation","gain","event","renderedBuffer"],"sources":["C:\\Users\\brigh\\storage\\js_project\\Gakugeki_WEB\\node_modules\\standardized-audio-context\\src\\factories\\render-native-offline-audio-context.ts"],"sourcesContent":["import { testPromiseSupport } from '../helpers/test-promise-support';\nimport { IOfflineAudioCompletionEvent } from '../interfaces';\nimport { TNativeAudioBuffer, TRenderNativeOfflineAudioContextFactory } from '../types';\n\nexport const createRenderNativeOfflineAudioContext: TRenderNativeOfflineAudioContextFactory = (\n    cacheTestResult,\n    createNativeGainNode,\n    createNativeScriptProcessorNode,\n    testOfflineAudioContextCurrentTimeSupport\n) => {\n    return (nativeOfflineAudioContext) => {\n        // Bug #21: Safari does not support promises yet.\n        if (cacheTestResult(testPromiseSupport, () => testPromiseSupport(nativeOfflineAudioContext))) {\n            // Bug #158: Chrome and Edge do not advance currentTime if it is not accessed while rendering the audio.\n            return Promise.resolve(\n                cacheTestResult(testOfflineAudioContextCurrentTimeSupport, testOfflineAudioContextCurrentTimeSupport)\n            ).then((isOfflineAudioContextCurrentTimeSupported) => {\n                if (!isOfflineAudioContextCurrentTimeSupported) {\n                    const scriptProcessorNode = createNativeScriptProcessorNode(nativeOfflineAudioContext, 512, 0, 1);\n\n                    nativeOfflineAudioContext.oncomplete = () => {\n                        scriptProcessorNode.onaudioprocess = null; // tslint:disable-line:deprecation\n                        scriptProcessorNode.disconnect();\n                    };\n                    scriptProcessorNode.onaudioprocess = () => nativeOfflineAudioContext.currentTime; // tslint:disable-line:deprecation\n\n                    scriptProcessorNode.connect(nativeOfflineAudioContext.destination);\n                }\n\n                return nativeOfflineAudioContext.startRendering();\n            });\n        }\n\n        return new Promise<TNativeAudioBuffer>((resolve) => {\n            // Bug #48: Safari does not render an OfflineAudioContext without any connected node.\n            const gainNode = createNativeGainNode(nativeOfflineAudioContext, {\n                channelCount: 1,\n                channelCountMode: 'explicit',\n                channelInterpretation: 'discrete',\n                gain: 0\n            });\n\n            nativeOfflineAudioContext.oncomplete = (event: IOfflineAudioCompletionEvent) => {\n                gainNode.disconnect();\n\n                resolve(event.renderedBuffer);\n            };\n\n            gainNode.connect(nativeOfflineAudioContext.destination);\n\n            nativeOfflineAudioContext.startRendering();\n        });\n    };\n};\n"]},"metadata":{},"sourceType":"module"}