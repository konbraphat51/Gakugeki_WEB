{"ast":null,"code":"export var createPermissionState = function createPermissionState(emitNotSupportedError, window, wrapSubscribeFunction) {\n  return function (permissionDescriptor) {\n    return wrapSubscribeFunction(function (observer) {\n      if (window === null || window.navigator === undefined || window.navigator.permissions === undefined || window.navigator.permissions.query === undefined) {\n        return emitNotSupportedError(observer);\n      }\n\n      var isActive = true;\n\n      var unsubscribe = function unsubscribe() {\n        isActive = false;\n      };\n\n      window.navigator.permissions.query(permissionDescriptor).then(function (permissionStatus) {\n        if (isActive) {\n          observer.next(permissionStatus.state);\n        }\n\n        if (isActive) {\n          permissionStatus.onchange = function () {\n            return observer.next(permissionStatus.state);\n          };\n\n          unsubscribe = function unsubscribe() {\n            permissionStatus.onchange = null;\n          };\n        }\n      }, function (err) {\n        if (isActive) {\n          observer.error(err);\n        }\n      });\n      return function () {\n        return unsubscribe();\n      };\n    });\n  };\n};","map":{"version":3,"mappings":"AAEA,OAAO,IAAMA,qBAAqB,GAA4B,SAAjDA,qBAAiD,CAACC,qBAAD,EAAwBC,MAAxB,EAAgCC,qBAAhC,EAAyD;EACnH,OAAO,UAACC,oBAAD;IAAA,OACHD,qBAAqB,CAAC,UAACE,QAAD,EAAa;MAC/B,IACIH,MAAM,KAAK,IAAX,IACAA,MAAM,CAACI,SAAP,KAAqBC,SADrB,IAEAL,MAAM,CAACI,SAAP,CAAiBE,WAAjB,KAAiCD,SAFjC,IAGAL,MAAM,CAACI,SAAP,CAAiBE,WAAjB,CAA6BC,KAA7B,KAAuCF,SAJ3C,EAKE;QACE,OAAON,qBAAqB,CAACI,QAAD,CAA5B;MACH;;MAED,IAAIK,QAAQ,GAAG,IAAf;;MACA,IAAIC,WAAW,GAAG,uBAAK;QACnBD,QAAQ,GAAG,KAAX;MACH,CAFD;;MAIAR,MAAM,CAACI,SAAP,CAAiBE,WAAjB,CAA6BC,KAA7B,CAAmCL,oBAAnC,EAAyDQ,IAAzD,CACI,UAACC,gBAAD,EAAqB;QACjB,IAAIH,QAAJ,EAAc;UACVL,QAAQ,CAACS,IAAT,CAAcD,gBAAgB,CAACE,KAA/B;QACH;;QAED,IAAIL,QAAJ,EAAc;UACVG,gBAAgB,CAACG,QAAjB,GAA4B;YAAA,OAAMX,QAAQ,CAACS,IAAT,CAAcD,gBAAgB,CAACE,KAA/B,CAAN;UAAA,CAA5B;;UAEAJ,WAAW,GAAG,uBAAK;YACfE,gBAAgB,CAACG,QAAjB,GAA4B,IAA5B;UACH,CAFD;QAGH;MACJ,CAbL,EAcI,UAACC,GAAD,EAAQ;QACJ,IAAIP,QAAJ,EAAc;UACVL,QAAQ,CAACa,KAAT,CAAeD,GAAf;QACH;MACJ,CAlBL;MAqBA,OAAO;QAAA,OAAMN,WAAW,EAAjB;MAAA,CAAP;IACH,CArCoB,CADlB;EAAA,CAAP;AAuCH,CAxCM","names":["createPermissionState","emitNotSupportedError","window","wrapSubscribeFunction","permissionDescriptor","observer","navigator","undefined","permissions","query","isActive","unsubscribe","then","permissionStatus","next","state","onchange","err","error"],"sources":["C:\\Users\\brigh\\storage\\js_project\\Gakugeki_WEB\\node_modules\\subscribable-things\\src\\factories\\permission-state.ts"],"sourcesContent":["import { TPermissionStateFactory } from '../types';\n\nexport const createPermissionState: TPermissionStateFactory = (emitNotSupportedError, window, wrapSubscribeFunction) => {\n    return (permissionDescriptor) =>\n        wrapSubscribeFunction((observer) => {\n            if (\n                window === null ||\n                window.navigator === undefined ||\n                window.navigator.permissions === undefined ||\n                window.navigator.permissions.query === undefined\n            ) {\n                return emitNotSupportedError(observer);\n            }\n\n            let isActive = true;\n            let unsubscribe = () => {\n                isActive = false;\n            };\n\n            window.navigator.permissions.query(permissionDescriptor).then(\n                (permissionStatus) => {\n                    if (isActive) {\n                        observer.next(permissionStatus.state);\n                    }\n\n                    if (isActive) {\n                        permissionStatus.onchange = () => observer.next(permissionStatus.state);\n\n                        unsubscribe = () => {\n                            permissionStatus.onchange = null;\n                        };\n                    }\n                },\n                (err) => {\n                    if (isActive) {\n                        observer.error(err);\n                    }\n                }\n            );\n\n            return () => unsubscribe();\n        });\n};\n"]},"metadata":{},"sourceType":"module"}