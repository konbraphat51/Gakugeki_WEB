{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/brigh/storage/js_project/Gakugeki_WEB/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _objectSpread from \"C:/Users/brigh/storage/js_project/Gakugeki_WEB/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"C:/Users/brigh/storage/js_project/Gakugeki_WEB/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { isNativeAudioNodeFaker } from '../guards/native-audio-node-faker';\nimport { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport var createPannerNodeRendererFactory = function createPannerNodeRendererFactory(connectAudioParam, createNativeChannelMergerNode, createNativeConstantSourceNode, createNativeGainNode, createNativePannerNode, getNativeAudioNode, nativeOfflineAudioContextConstructor, renderAutomation, renderInputsOfAudioNode, renderNativeOfflineAudioContext) {\n  return function () {\n    var renderedNativeAudioNodes = new WeakMap();\n    var renderedBufferPromise = null;\n\n    var createAudioNode = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(proxy, nativeOfflineAudioContext) {\n        var nativeGainNode, nativePannerNode, commonAudioNodeOptions, commonNativePannerNodeOptions, nativePannerNodeIsOwnedByContext, options, _ret;\n\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                nativeGainNode = null;\n                nativePannerNode = getNativeAudioNode(proxy);\n                commonAudioNodeOptions = {\n                  channelCount: nativePannerNode.channelCount,\n                  channelCountMode: nativePannerNode.channelCountMode,\n                  channelInterpretation: nativePannerNode.channelInterpretation\n                };\n                commonNativePannerNodeOptions = _objectSpread(_objectSpread({}, commonAudioNodeOptions), {}, {\n                  coneInnerAngle: nativePannerNode.coneInnerAngle,\n                  coneOuterAngle: nativePannerNode.coneOuterAngle,\n                  coneOuterGain: nativePannerNode.coneOuterGain,\n                  distanceModel: nativePannerNode.distanceModel,\n                  maxDistance: nativePannerNode.maxDistance,\n                  panningModel: nativePannerNode.panningModel,\n                  refDistance: nativePannerNode.refDistance,\n                  rolloffFactor: nativePannerNode.rolloffFactor\n                }); // If the initially used nativePannerNode was not constructed on the same OfflineAudioContext it needs to be created again.\n\n                nativePannerNodeIsOwnedByContext = isOwnedByContext(nativePannerNode, nativeOfflineAudioContext); // Bug #124: Safari does not support modifying the orientation and the position with AudioParams.\n\n                if ('bufferSize' in nativePannerNode) {\n                  nativeGainNode = createNativeGainNode(nativeOfflineAudioContext, _objectSpread(_objectSpread({}, commonAudioNodeOptions), {}, {\n                    gain: 1\n                  }));\n                } else if (!nativePannerNodeIsOwnedByContext) {\n                  options = _objectSpread(_objectSpread({}, commonNativePannerNodeOptions), {}, {\n                    orientationX: nativePannerNode.orientationX.value,\n                    orientationY: nativePannerNode.orientationY.value,\n                    orientationZ: nativePannerNode.orientationZ.value,\n                    positionX: nativePannerNode.positionX.value,\n                    positionY: nativePannerNode.positionY.value,\n                    positionZ: nativePannerNode.positionZ.value\n                  });\n                  nativePannerNode = createNativePannerNode(nativeOfflineAudioContext, options);\n                }\n\n                renderedNativeAudioNodes.set(nativeOfflineAudioContext, nativeGainNode === null ? nativePannerNode : nativeGainNode);\n\n                if (!(nativeGainNode !== null)) {\n                  _context4.next = 12;\n                  break;\n                }\n\n                return _context4.delegateYield( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n                  var partialOfflineAudioContext, nativeChannelMergerNode, renderedBuffer, inputGainNode, channelDatas, i, lastOrientation, lastPosition, gateGainNode, partialPannerNode, _i, orientation, positon, currentTime;\n\n                  return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n                    while (1) {\n                      switch (_context3.prev = _context3.next) {\n                        case 0:\n                          if (!(renderedBufferPromise === null)) {\n                            _context3.next = 7;\n                            break;\n                          }\n\n                          if (!(nativeOfflineAudioContextConstructor === null)) {\n                            _context3.next = 3;\n                            break;\n                          }\n\n                          throw new Error('Missing the native OfflineAudioContext constructor.');\n\n                        case 3:\n                          partialOfflineAudioContext = new nativeOfflineAudioContextConstructor(6, // Bug #17: Safari does not yet expose the length.\n                          proxy.context.length, nativeOfflineAudioContext.sampleRate);\n                          nativeChannelMergerNode = createNativeChannelMergerNode(partialOfflineAudioContext, {\n                            channelCount: 1,\n                            channelCountMode: 'explicit',\n                            channelInterpretation: 'speakers',\n                            numberOfInputs: 6\n                          });\n                          nativeChannelMergerNode.connect(partialOfflineAudioContext.destination);\n                          renderedBufferPromise = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n                            var nativeConstantSourceNodes, i;\n                            return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n                              while (1) {\n                                switch (_context2.prev = _context2.next) {\n                                  case 0:\n                                    _context2.next = 2;\n                                    return Promise.all([proxy.orientationX, proxy.orientationY, proxy.orientationZ, proxy.positionX, proxy.positionY, proxy.positionZ].map( /*#__PURE__*/function () {\n                                      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(audioParam, index) {\n                                        var nativeConstantSourceNode;\n                                        return _regeneratorRuntime().wrap(function _callee$(_context) {\n                                          while (1) {\n                                            switch (_context.prev = _context.next) {\n                                              case 0:\n                                                nativeConstantSourceNode = createNativeConstantSourceNode(partialOfflineAudioContext, {\n                                                  channelCount: 1,\n                                                  channelCountMode: 'explicit',\n                                                  channelInterpretation: 'discrete',\n                                                  offset: index === 0 ? 1 : 0\n                                                });\n                                                _context.next = 3;\n                                                return renderAutomation(partialOfflineAudioContext, audioParam, nativeConstantSourceNode.offset);\n\n                                              case 3:\n                                                return _context.abrupt(\"return\", nativeConstantSourceNode);\n\n                                              case 4:\n                                              case \"end\":\n                                                return _context.stop();\n                                            }\n                                          }\n                                        }, _callee);\n                                      }));\n\n                                      return function (_x3, _x4) {\n                                        return _ref3.apply(this, arguments);\n                                      };\n                                    }()));\n\n                                  case 2:\n                                    nativeConstantSourceNodes = _context2.sent;\n\n                                    for (i = 0; i < 6; i += 1) {\n                                      nativeConstantSourceNodes[i].connect(nativeChannelMergerNode, 0, i);\n                                      nativeConstantSourceNodes[i].start(0);\n                                    }\n\n                                    return _context2.abrupt(\"return\", renderNativeOfflineAudioContext(partialOfflineAudioContext));\n\n                                  case 5:\n                                  case \"end\":\n                                    return _context2.stop();\n                                }\n                              }\n                            }, _callee2);\n                          }))();\n\n                        case 7:\n                          _context3.next = 9;\n                          return renderedBufferPromise;\n\n                        case 9:\n                          renderedBuffer = _context3.sent;\n                          inputGainNode = createNativeGainNode(nativeOfflineAudioContext, _objectSpread(_objectSpread({}, commonAudioNodeOptions), {}, {\n                            gain: 1\n                          }));\n                          _context3.next = 13;\n                          return renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, inputGainNode);\n\n                        case 13:\n                          channelDatas = [];\n\n                          for (i = 0; i < renderedBuffer.numberOfChannels; i += 1) {\n                            channelDatas.push(renderedBuffer.getChannelData(i));\n                          }\n\n                          lastOrientation = [channelDatas[0][0], channelDatas[1][0], channelDatas[2][0]];\n                          lastPosition = [channelDatas[3][0], channelDatas[4][0], channelDatas[5][0]];\n                          gateGainNode = createNativeGainNode(nativeOfflineAudioContext, _objectSpread(_objectSpread({}, commonAudioNodeOptions), {}, {\n                            gain: 1\n                          }));\n                          partialPannerNode = createNativePannerNode(nativeOfflineAudioContext, _objectSpread(_objectSpread({}, commonNativePannerNodeOptions), {}, {\n                            orientationX: lastOrientation[0],\n                            orientationY: lastOrientation[1],\n                            orientationZ: lastOrientation[2],\n                            positionX: lastPosition[0],\n                            positionY: lastPosition[1],\n                            positionZ: lastPosition[2]\n                          }));\n                          inputGainNode.connect(gateGainNode).connect(partialPannerNode.inputs[0]);\n                          partialPannerNode.connect(nativeGainNode);\n\n                          for (_i = 128; _i < renderedBuffer.length; _i += 128) {\n                            orientation = [channelDatas[0][_i], channelDatas[1][_i], channelDatas[2][_i]];\n                            positon = [channelDatas[3][_i], channelDatas[4][_i], channelDatas[5][_i]];\n\n                            if (orientation.some(function (value, index) {\n                              return value !== lastOrientation[index];\n                            }) || positon.some(function (value, index) {\n                              return value !== lastPosition[index];\n                            })) {\n                              lastOrientation = orientation;\n                              lastPosition = positon;\n                              currentTime = _i / nativeOfflineAudioContext.sampleRate;\n                              gateGainNode.gain.setValueAtTime(0, currentTime);\n                              gateGainNode = createNativeGainNode(nativeOfflineAudioContext, _objectSpread(_objectSpread({}, commonAudioNodeOptions), {}, {\n                                gain: 0\n                              }));\n                              partialPannerNode = createNativePannerNode(nativeOfflineAudioContext, _objectSpread(_objectSpread({}, commonNativePannerNodeOptions), {}, {\n                                orientationX: lastOrientation[0],\n                                orientationY: lastOrientation[1],\n                                orientationZ: lastOrientation[2],\n                                positionX: lastPosition[0],\n                                positionY: lastPosition[1],\n                                positionZ: lastPosition[2]\n                              }));\n                              gateGainNode.gain.setValueAtTime(1, currentTime);\n                              inputGainNode.connect(gateGainNode).connect(partialPannerNode.inputs[0]);\n                              partialPannerNode.connect(nativeGainNode);\n                            }\n                          }\n\n                          return _context3.abrupt(\"return\", {\n                            v: nativeGainNode\n                          });\n\n                        case 23:\n                        case \"end\":\n                          return _context3.stop();\n                      }\n                    }\n                  }, _callee3);\n                })(), \"t0\", 9);\n\n              case 9:\n                _ret = _context4.t0;\n\n                if (!(typeof _ret === \"object\")) {\n                  _context4.next = 12;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", _ret.v);\n\n              case 12:\n                if (nativePannerNodeIsOwnedByContext) {\n                  _context4.next = 27;\n                  break;\n                }\n\n                _context4.next = 15;\n                return renderAutomation(nativeOfflineAudioContext, proxy.orientationX, nativePannerNode.orientationX);\n\n              case 15:\n                _context4.next = 17;\n                return renderAutomation(nativeOfflineAudioContext, proxy.orientationY, nativePannerNode.orientationY);\n\n              case 17:\n                _context4.next = 19;\n                return renderAutomation(nativeOfflineAudioContext, proxy.orientationZ, nativePannerNode.orientationZ);\n\n              case 19:\n                _context4.next = 21;\n                return renderAutomation(nativeOfflineAudioContext, proxy.positionX, nativePannerNode.positionX);\n\n              case 21:\n                _context4.next = 23;\n                return renderAutomation(nativeOfflineAudioContext, proxy.positionY, nativePannerNode.positionY);\n\n              case 23:\n                _context4.next = 25;\n                return renderAutomation(nativeOfflineAudioContext, proxy.positionZ, nativePannerNode.positionZ);\n\n              case 25:\n                _context4.next = 39;\n                break;\n\n              case 27:\n                _context4.next = 29;\n                return connectAudioParam(nativeOfflineAudioContext, proxy.orientationX, nativePannerNode.orientationX);\n\n              case 29:\n                _context4.next = 31;\n                return connectAudioParam(nativeOfflineAudioContext, proxy.orientationY, nativePannerNode.orientationY);\n\n              case 31:\n                _context4.next = 33;\n                return connectAudioParam(nativeOfflineAudioContext, proxy.orientationZ, nativePannerNode.orientationZ);\n\n              case 33:\n                _context4.next = 35;\n                return connectAudioParam(nativeOfflineAudioContext, proxy.positionX, nativePannerNode.positionX);\n\n              case 35:\n                _context4.next = 37;\n                return connectAudioParam(nativeOfflineAudioContext, proxy.positionY, nativePannerNode.positionY);\n\n              case 37:\n                _context4.next = 39;\n                return connectAudioParam(nativeOfflineAudioContext, proxy.positionZ, nativePannerNode.positionZ);\n\n              case 39:\n                if (!isNativeAudioNodeFaker(nativePannerNode)) {\n                  _context4.next = 44;\n                  break;\n                }\n\n                _context4.next = 42;\n                return renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativePannerNode.inputs[0]);\n\n              case 42:\n                _context4.next = 46;\n                break;\n\n              case 44:\n                _context4.next = 46;\n                return renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativePannerNode);\n\n              case 46:\n                return _context4.abrupt(\"return\", nativePannerNode);\n\n              case 47:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      return function createAudioNode(_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    return {\n      render: function render(proxy, nativeOfflineAudioContext) {\n        var renderedNativeGainNodeOrNativePannerNode = renderedNativeAudioNodes.get(nativeOfflineAudioContext);\n\n        if (renderedNativeGainNodeOrNativePannerNode !== undefined) {\n          return Promise.resolve(renderedNativeGainNodeOrNativePannerNode);\n        }\n\n        return createAudioNode(proxy, nativeOfflineAudioContext);\n      }\n    };\n  };\n};","map":{"version":3,"mappings":"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","names":["isNativeAudioNodeFaker","isOwnedByContext","createPannerNodeRendererFactory","connectAudioParam","createNativeChannelMergerNode","createNativeConstantSourceNode","createNativeGainNode","createNativePannerNode","getNativeAudioNode","nativeOfflineAudioContextConstructor","renderAutomation","renderInputsOfAudioNode","renderNativeOfflineAudioContext","renderedNativeAudioNodes","WeakMap","renderedBufferPromise","createAudioNode","proxy","nativeOfflineAudioContext","nativeGainNode","nativePannerNode","commonAudioNodeOptions","channelCount","channelCountMode","channelInterpretation","commonNativePannerNodeOptions","coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","panningModel","refDistance","rolloffFactor","nativePannerNodeIsOwnedByContext","gain","options","orientationX","value","orientationY","orientationZ","positionX","positionY","positionZ","set","Error","partialOfflineAudioContext","context","length","sampleRate","nativeChannelMergerNode","numberOfInputs","connect","destination","Promise","all","map","audioParam","index","nativeConstantSourceNode","offset","nativeConstantSourceNodes","i","start","renderedBuffer","inputGainNode","channelDatas","numberOfChannels","push","getChannelData","lastOrientation","lastPosition","gateGainNode","partialPannerNode","inputs","orientation","positon","some","currentTime","setValueAtTime","render","renderedNativeGainNodeOrNativePannerNode","get","undefined","resolve"],"sources":["C:\\Users\\brigh\\storage\\js_project\\Gakugeki_WEB\\node_modules\\standardized-audio-context\\src\\factories\\panner-node-renderer-factory.ts"],"sourcesContent":["import { isNativeAudioNodeFaker } from '../guards/native-audio-node-faker';\nimport { isOwnedByContext } from '../helpers/is-owned-by-context';\nimport { IMinimalOfflineAudioContext, INativePannerNodeFaker, IOfflineAudioContext, IPannerNode } from '../interfaces';\nimport {\n    TNativeAudioBuffer,\n    TNativeGainNode,\n    TNativeOfflineAudioContext,\n    TNativePannerNode,\n    TPannerNodeRendererFactoryFactory\n} from '../types';\n\nexport const createPannerNodeRendererFactory: TPannerNodeRendererFactoryFactory = (\n    connectAudioParam,\n    createNativeChannelMergerNode,\n    createNativeConstantSourceNode,\n    createNativeGainNode,\n    createNativePannerNode,\n    getNativeAudioNode,\n    nativeOfflineAudioContextConstructor,\n    renderAutomation,\n    renderInputsOfAudioNode,\n    renderNativeOfflineAudioContext\n) => {\n    return <T extends IMinimalOfflineAudioContext | IOfflineAudioContext>() => {\n        const renderedNativeAudioNodes = new WeakMap<TNativeOfflineAudioContext, TNativeGainNode | TNativePannerNode>();\n\n        let renderedBufferPromise: null | Promise<TNativeAudioBuffer> = null;\n\n        const createAudioNode = async (proxy: IPannerNode<T>, nativeOfflineAudioContext: TNativeOfflineAudioContext) => {\n            let nativeGainNode: null | TNativeGainNode = null;\n            let nativePannerNode = getNativeAudioNode<T, TNativePannerNode>(proxy);\n\n            const commonAudioNodeOptions = {\n                channelCount: nativePannerNode.channelCount,\n                channelCountMode: nativePannerNode.channelCountMode,\n                channelInterpretation: nativePannerNode.channelInterpretation\n            };\n            const commonNativePannerNodeOptions = {\n                ...commonAudioNodeOptions,\n                coneInnerAngle: nativePannerNode.coneInnerAngle,\n                coneOuterAngle: nativePannerNode.coneOuterAngle,\n                coneOuterGain: nativePannerNode.coneOuterGain,\n                distanceModel: nativePannerNode.distanceModel,\n                maxDistance: nativePannerNode.maxDistance,\n                panningModel: nativePannerNode.panningModel,\n                refDistance: nativePannerNode.refDistance,\n                rolloffFactor: nativePannerNode.rolloffFactor\n            };\n\n            // If the initially used nativePannerNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativePannerNodeIsOwnedByContext = isOwnedByContext(nativePannerNode, nativeOfflineAudioContext);\n\n            // Bug #124: Safari does not support modifying the orientation and the position with AudioParams.\n            if ('bufferSize' in nativePannerNode) {\n                nativeGainNode = createNativeGainNode(nativeOfflineAudioContext, { ...commonAudioNodeOptions, gain: 1 });\n            } else if (!nativePannerNodeIsOwnedByContext) {\n                const options = {\n                    ...commonNativePannerNodeOptions,\n                    orientationX: nativePannerNode.orientationX.value,\n                    orientationY: nativePannerNode.orientationY.value,\n                    orientationZ: nativePannerNode.orientationZ.value,\n                    positionX: nativePannerNode.positionX.value,\n                    positionY: nativePannerNode.positionY.value,\n                    positionZ: nativePannerNode.positionZ.value\n                };\n\n                nativePannerNode = createNativePannerNode(nativeOfflineAudioContext, options);\n            }\n\n            renderedNativeAudioNodes.set(nativeOfflineAudioContext, nativeGainNode === null ? nativePannerNode : nativeGainNode);\n\n            if (nativeGainNode !== null) {\n                if (renderedBufferPromise === null) {\n                    if (nativeOfflineAudioContextConstructor === null) {\n                        throw new Error('Missing the native OfflineAudioContext constructor.');\n                    }\n\n                    const partialOfflineAudioContext = new nativeOfflineAudioContextConstructor(\n                        6,\n                        // Bug #17: Safari does not yet expose the length.\n                        proxy.context.length,\n                        nativeOfflineAudioContext.sampleRate\n                    );\n                    const nativeChannelMergerNode = createNativeChannelMergerNode(partialOfflineAudioContext, {\n                        channelCount: 1,\n                        channelCountMode: 'explicit',\n                        channelInterpretation: 'speakers',\n                        numberOfInputs: 6\n                    });\n                    nativeChannelMergerNode.connect(partialOfflineAudioContext.destination);\n\n                    renderedBufferPromise = (async () => {\n                        const nativeConstantSourceNodes = await Promise.all(\n                            [\n                                proxy.orientationX,\n                                proxy.orientationY,\n                                proxy.orientationZ,\n                                proxy.positionX,\n                                proxy.positionY,\n                                proxy.positionZ\n                            ].map(async (audioParam, index) => {\n                                const nativeConstantSourceNode = createNativeConstantSourceNode(partialOfflineAudioContext, {\n                                    channelCount: 1,\n                                    channelCountMode: 'explicit',\n                                    channelInterpretation: 'discrete',\n                                    offset: index === 0 ? 1 : 0\n                                });\n\n                                await renderAutomation(partialOfflineAudioContext, audioParam, nativeConstantSourceNode.offset);\n\n                                return nativeConstantSourceNode;\n                            })\n                        );\n\n                        for (let i = 0; i < 6; i += 1) {\n                            nativeConstantSourceNodes[i].connect(nativeChannelMergerNode, 0, i);\n                            nativeConstantSourceNodes[i].start(0);\n                        }\n\n                        return renderNativeOfflineAudioContext(partialOfflineAudioContext);\n                    })();\n                }\n\n                const renderedBuffer = await renderedBufferPromise;\n                const inputGainNode = createNativeGainNode(nativeOfflineAudioContext, { ...commonAudioNodeOptions, gain: 1 });\n\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, inputGainNode);\n\n                const channelDatas: Float32Array[] = [];\n\n                for (let i = 0; i < renderedBuffer.numberOfChannels; i += 1) {\n                    channelDatas.push(renderedBuffer.getChannelData(i));\n                }\n\n                let lastOrientation = [channelDatas[0][0], channelDatas[1][0], channelDatas[2][0]];\n                let lastPosition = [channelDatas[3][0], channelDatas[4][0], channelDatas[5][0]];\n                let gateGainNode = createNativeGainNode(nativeOfflineAudioContext, { ...commonAudioNodeOptions, gain: 1 });\n                let partialPannerNode = createNativePannerNode(nativeOfflineAudioContext, {\n                    ...commonNativePannerNodeOptions,\n                    orientationX: lastOrientation[0],\n                    orientationY: lastOrientation[1],\n                    orientationZ: lastOrientation[2],\n                    positionX: lastPosition[0],\n                    positionY: lastPosition[1],\n                    positionZ: lastPosition[2]\n                });\n\n                inputGainNode.connect(gateGainNode).connect((<INativePannerNodeFaker>partialPannerNode).inputs[0]);\n                partialPannerNode.connect(nativeGainNode);\n\n                for (let i = 128; i < renderedBuffer.length; i += 128) {\n                    const orientation: [number, number, number] = [channelDatas[0][i], channelDatas[1][i], channelDatas[2][i]];\n                    const positon: [number, number, number] = [channelDatas[3][i], channelDatas[4][i], channelDatas[5][i]];\n\n                    if (\n                        orientation.some((value, index) => value !== lastOrientation[index]) ||\n                        positon.some((value, index) => value !== lastPosition[index])\n                    ) {\n                        lastOrientation = orientation;\n                        lastPosition = positon;\n\n                        const currentTime = i / nativeOfflineAudioContext.sampleRate;\n\n                        gateGainNode.gain.setValueAtTime(0, currentTime);\n\n                        gateGainNode = createNativeGainNode(nativeOfflineAudioContext, { ...commonAudioNodeOptions, gain: 0 });\n                        partialPannerNode = createNativePannerNode(nativeOfflineAudioContext, {\n                            ...commonNativePannerNodeOptions,\n                            orientationX: lastOrientation[0],\n                            orientationY: lastOrientation[1],\n                            orientationZ: lastOrientation[2],\n                            positionX: lastPosition[0],\n                            positionY: lastPosition[1],\n                            positionZ: lastPosition[2]\n                        });\n\n                        gateGainNode.gain.setValueAtTime(1, currentTime);\n\n                        inputGainNode.connect(gateGainNode).connect((<INativePannerNodeFaker>partialPannerNode).inputs[0]);\n                        partialPannerNode.connect(nativeGainNode);\n                    }\n                }\n\n                return nativeGainNode;\n            }\n\n            if (!nativePannerNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.orientationX, nativePannerNode.orientationX);\n                await renderAutomation(nativeOfflineAudioContext, proxy.orientationY, nativePannerNode.orientationY);\n                await renderAutomation(nativeOfflineAudioContext, proxy.orientationZ, nativePannerNode.orientationZ);\n                await renderAutomation(nativeOfflineAudioContext, proxy.positionX, nativePannerNode.positionX);\n                await renderAutomation(nativeOfflineAudioContext, proxy.positionY, nativePannerNode.positionY);\n                await renderAutomation(nativeOfflineAudioContext, proxy.positionZ, nativePannerNode.positionZ);\n            } else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.orientationX, nativePannerNode.orientationX);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.orientationY, nativePannerNode.orientationY);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.orientationZ, nativePannerNode.orientationZ);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.positionX, nativePannerNode.positionX);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.positionY, nativePannerNode.positionY);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.positionZ, nativePannerNode.positionZ);\n            }\n\n            if (isNativeAudioNodeFaker(nativePannerNode)) {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativePannerNode.inputs[0]);\n            } else {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativePannerNode);\n            }\n\n            return nativePannerNode;\n        };\n\n        return {\n            render(\n                proxy: IPannerNode<T>,\n                nativeOfflineAudioContext: TNativeOfflineAudioContext\n            ): Promise<TNativeGainNode | TNativePannerNode> {\n                const renderedNativeGainNodeOrNativePannerNode = renderedNativeAudioNodes.get(nativeOfflineAudioContext);\n\n                if (renderedNativeGainNodeOrNativePannerNode !== undefined) {\n                    return Promise.resolve(renderedNativeGainNodeOrNativePannerNode);\n                }\n\n                return createAudioNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n"]},"metadata":{},"sourceType":"module"}